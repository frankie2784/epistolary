<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>epistolary</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="favicon.ico">
    <!-- <script>document.documentElement.className = 'js';</script> -->
</head>
<body class="epistolary">
    <!-- <div class="topnav"></div> -->
    <section class="content">
        <div class="content__header">
            <img class="content__title" width="150px" object-fit="cover" src="img/epistolary logo transparent light.png"/>
        </div>
        <div class="slideshow">
            <div id="slide-1" class="slide" style="background-image: url(img/map.png)"></div>
            <div id="slide-2" class="slide" style="background-image: url(img/booth.jpg)"></div>
            <div id="slide-3" class="slide" style="background-image: url(img/jug.jpg)"></div>
            <div class="pieces" style="background-image: url(img/map.png)"></div>
        </div>
        <nav class="menu">
            <a class="menu__item menu__item--current" href="#slide-1" data-image="img/map.png">Handmade map thing <span>Rute Chaves</a>
            <a class="menu__item" href="#slide-2" data-image="img/booth.jpg">Photobooth <span>Paul Yacoumis</span></a>
            <a class="menu__item" href="#slide-3" data-image="img/jug.jpg">Weird jug thing <span>Ancient greeks</span></a>
        </nav>
    </section>
    <script type="text/javascript">
        let frontpage = document.querySelector('.content');
        frontpage.style.opacity = 1
        window.addEventListener('scroll', function(){
            if (window.pageYOffset < window.innerHeight/2) {
                let value = 1
                frontpage.style.opacity = value;
            } else {
                let value = 1 - 2*(window.pageYOffset-window.innerHeight/2)/(window.innerHeight);
                frontpage.style.opacity = Math.max(0,value);
            }});
    </script>
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <script src="js/anime.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        {
            imagesLoaded(document.body, { background: true }, () => document.body.classList.remove('loading'));
            
            const menuItems = Array.from(document.querySelectorAll('.menu > .menu__item'));
            
            const piecesObj = new Pieces(document.querySelector('.slideshow > .pieces'), {
                pieces: {rows: 14, columns: 12},
                delay: [0,40],
                hasTilt: true,
                tilt: {
                    maxRotationX: -5, 
                    maxRotationY: -5, 
                    maxTranslationX: -24, 
                    maxTranslationY: -4
                }
            });
            
            let isAnimating = false;
            let current = 0;

            const openImage = (ev, item, pos) => {
                ev.preventDefault();
                // if ( isAnimating || current === pos ) {
                //     return false;
                // }
                isAnimating = true;
                menuItems[current].classList.remove('menu__item--current');
                current = pos;
                menuItems[current].classList.add('menu__item--current');
                const imgsrc = item.dataset.image;

                piecesObj.animate({
                    duration: 200,
                    easing: 'easeOutQuad',
                    delay: (t,i,l) => {
                        return parseInt(t.dataset.row) * parseInt(t.dataset.delay);
                    },
                    translateX: (t,i) => {
                        return anime.random(-50,50)+'px';
                    },
                    translateY: (t,i) => { 
                        return anime.random(-800,-200)+'px';
                    },
                    rotateZ: (t,i) => { 
                        return anime.random(-45,45)+'deg';
                    },
                    opacity: 0,
                    complete: () => {
                        piecesObj.setImage(imgsrc);

                        piecesObj.animate({
                            duration: 500,
                            easing: [0.3,1,0.3,1],
                            delay: (t,i,l) => {
                                return parseInt(t.dataset.row) * parseInt(t.dataset.delay);
                            },
                            translateX: 0,
                            translateY: () => {
                                return [anime.random(200,800)+'px','0px'];
                            },
                            rotateZ: 0,
                            opacity: {
                                value: 1,
                                duration: 500,
                                easing: 'linear'
                            },
                            complete: () => {
                                isAnimating = false;
                            }
                        });
                    }
                });
            };

            menuItems.forEach((item,pos) => item.addEventListener('click', (ev) => openImage(ev,item,pos)));
        }
    </script>
    <!-- The overlay -->
    <div id="myNav" class="overlay">
          <!-- Button to close the overlay navigation -->
        <!-- <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a> -->

        <!-- Overlay content -->
        <div class="overlay-content">
            <a href="index.html">About</a>
            <a href="content.html">Letters</a>
            <a href="map.html">Map</a>
            <a href="#">Workshop</a>
            <a href="#">Social</a>
        </div>

    </div>
    <input type="checkbox" id="nav-menu4" onclick="navbar()"/>   
    <label id="label" for="nav-menu4">
        <span id="span1"></span>
        <span id="span2"></span>
        <span id="span3"></span>
    </label>
    <script>
        function navbar() {
            let checkbox = document.querySelector('#nav-menu4');
            if (checkbox.checked) {
                document.getElementById("myNav").style.height = "100%";
                document.getElementById("span1").style.backgroundColor = "#818181";
                document.getElementById("span2").style.backgroundColor = "#818181";
                document.getElementById("span3").style.backgroundColor = "#818181";
            } else {
                document.getElementById("myNav").style.height = "0%";
                document.getElementById("span1").style.backgroundColor = "#3d5a6cff";
                document.getElementById("span2").style.backgroundColor = "#3d5a6cff";
                document.getElementById("span3").style.backgroundColor = "#3d5a6cff";
            }
        }
    </script>
</body>
</html>